<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Lockless Logger: src/core/api/logger.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Lockless Logger
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_aebb8dcc11953d78e620bbef0b9e2183.html">core</a></li><li class="navelem"><a class="el" href="dir_64487c75f92555db8bd74e7be47264bb.html">api</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">logger.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This module provides an implementation of a logger utility.  
<a href="#details">More...</a></p>
<div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="logger_8h__dep__incl.png" border="0" usemap="#src_2core_2api_2logger_8hdep" alt=""/></div>
<map name="src_2core_2api_2logger_8hdep" id="src_2core_2api_2logger_8hdep">
<area shape="rect" id="node2" href="logger_8c.html" title="This module provides an implementation of a logger utility. " alt="" coords="5,80,179,107"/>
</map>
</div>
</div>
<p><a href="logger_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a56b3ba492f8e4335459115b71086acea"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="logger_8h.html#a56b3ba492f8e4335459115b71086acea">LOG_MSG</a>(loggingLevel,  msg ...)&#160;&#160;&#160;<a class="el" href="logger_8c.html#a033a9a1b552c4067c8d04a9564093f35">logMessage</a>(loggingLevel, __FILE__,__PRETTY_FUNCTION__,  __LINE__  , msg)</td></tr>
<tr class="separator:a56b3ba492f8e4335459115b71086acea"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:aa20da85019c72d11fcdb2d7d627dc70d"><td class="memItemLeft" align="right" valign="top"><a id="aa20da85019c72d11fcdb2d7d627dc70d"></a>enum &#160;</td><td class="memItemRight" valign="bottom"><b>loggerStatusCodes</b> { <b>LOG_STATUS_FAILURE</b> = -1, 
<b>LOG_STATUS_SUCCESS</b>
 }</td></tr>
<tr class="separator:aa20da85019c72d11fcdb2d7d627dc70d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5096002e05063d13577205e0bc5f0564"><td class="memItemLeft" align="right" valign="top"><a id="a5096002e05063d13577205e0bc5f0564"></a>enum &#160;</td><td class="memItemRight" valign="bottom"><b>logLevels</b> { <br />
&#160;&#160;<b>LOG_LEVEL_NONE</b>, 
<b>LOG_LEVEL_EMERG</b>, 
<b>LOG_LEVEL_ALERT</b>, 
<b>LOG_LEVEL_CRITICAL</b>, 
<br />
&#160;&#160;<b>LOG_LEVEL_ERROR</b>, 
<b>LOG_LEVEL_WARNING</b>, 
<b>LOG_LEVEL_NOTICE</b>, 
<b>LOG_LEVEL_INFO</b>, 
<br />
&#160;&#160;<b>LOG_LEVEL_DEBUG</b>, 
<b>LOG_LEVEL_TRACE</b>
<br />
 }</td></tr>
<tr class="separator:a5096002e05063d13577205e0bc5f0564"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a2d48484a943623d3059298588b0aa032"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="logger_8h.html#a2d48484a943623d3059298588b0aa032">initLogger</a> (const int buffersNum, const int buffersSize, const int sharedBuffSize, const int loggingLevel)</td></tr>
<tr class="separator:a2d48484a943623d3059298588b0aa032"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a24cb7a769ac91199a40ffd5d0ba0daca"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="logger_8h.html#a24cb7a769ac91199a40ffd5d0ba0daca">registerThread</a> ()</td></tr>
<tr class="separator:a24cb7a769ac91199a40ffd5d0ba0daca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a73ce845d8dab297b5d82febb0ae35fec"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="logger_8h.html#a73ce845d8dab297b5d82febb0ae35fec">unregisterThread</a> ()</td></tr>
<tr class="separator:a73ce845d8dab297b5d82febb0ae35fec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a033a9a1b552c4067c8d04a9564093f35"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="logger_8h.html#a033a9a1b552c4067c8d04a9564093f35">logMessage</a> (const int loggingLevel, char *file, const char *func, const int line, const char *msg,...)</td></tr>
<tr class="separator:a033a9a1b552c4067c8d04a9564093f35"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4339ec77ab029db1548580313b9dc605"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="logger_8h.html#a4339ec77ab029db1548580313b9dc605">terminateLogger</a> ()</td></tr>
<tr class="separator:a4339ec77ab029db1548580313b9dc605"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b26c3643213fb562e2a488bc28b3786"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="logger_8h.html#a8b26c3643213fb562e2a488bc28b3786">setLoggingLevel</a> (const int loggingLevel)</td></tr>
<tr class="separator:a8b26c3643213fb562e2a488bc28b3786"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:aa254166da6d7ec9dec0ee516b9fe7f18"><td class="memItemLeft" align="right" valign="top"><a id="aa254166da6d7ec9dec0ee516b9fe7f18"></a>
long long&#160;</td><td class="memItemRight" valign="bottom"><b>cnt</b></td></tr>
<tr class="separator:aa254166da6d7ec9dec0ee516b9fe7f18"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This module provides an implementation of a logger utility. </p>
<dl class="section author"><dt>Author</dt><dd>Barak Sason Rofman The idea behind this utility is to reduce as much as possible the impact of logging on runtime. Part of this reduction comes at the cost of having to parse and reorganize the messages in the log files using a dedicated tool (yet to be implemented) as there is no guarantee on the order of logged messages.</dd></dl>
<p>The logger operates in the following way: The logger provides several (number and size are user-defined) pre-allocated buffers which threads can 'register' to and receive a private buffer. In addition, a single, shared buffer is also pre-allocated (size is user-defined). The number of buffers and their size is modifiable at runtime (not yet implemented).</p>
<p>The basic logic of the logger utility is that worker threads write messages in one of 3 ways that will be described next, and an internal logger threads constantly iterates the existing buffers and drains the data to the log file.</p>
<p>As all allocation are allocated at the initialization stage, no special treatment it needed for "out
of memory" cases.</p>
<p>The following writing levels exist: Level 1 - Lockless writing: Lockless writing is achieved by assigning each thread a private ring buffer. A worker threads write to that buffer and the logger thread drains that buffer into a log file.</p>
<p>In case the private ring buffer is full and not yet drained, or in case the worker thread has not registered for a private buffer, we fall down to the following writing methods:</p>
<p>Level 2 - Shared buffer writing: The worker thread will write it's data into a buffer that's shared across all threads. This is done in a synchronized manner.</p>
<p>In case the private ring buffer is full and not yet drained AND the shared ring buffer is full and not yet drained, or in case the worker thread has not registered for a private buffer, we fall down to the following writing methods:</p>
<p>Level 3 - Direct write: This is the slowest form of writing - the worker thread directly write to the log file.</p>
<dl class="section user"><dt>License: Apache License, Version 2.0</dt><dd></dd></dl>
<dl class="section user"><dt>Copywrite: (C) [2019] [Barak Sason Rofman]</dt><dd></dd></dl>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a56b3ba492f8e4335459115b71086acea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a56b3ba492f8e4335459115b71086acea">&#9670;&nbsp;</a></span>LOG_MSG</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOG_MSG</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">loggingLevel, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">msg ...&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;<a class="el" href="logger_8c.html#a033a9a1b552c4067c8d04a9564093f35">logMessage</a>(loggingLevel, __FILE__,__PRETTY_FUNCTION__,  __LINE__  , msg)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>A macro that defines the usage for 'logMessage(...) API </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a2d48484a943623d3059298588b0aa032"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2d48484a943623d3059298588b0aa032">&#9670;&nbsp;</a></span>initLogger()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int initLogger </td>
          <td>(</td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>buffersNum</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>buffersSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>sharedBuffSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>loggingLevel</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Initialize all data required by the logger. Note: This method must be called before any other API is used, and it can be called only once </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">buffersNum</td><td>Number of threads that will be able to register </td></tr>
    <tr><td class="paramname">buffersSize</td><td>Size of private buffers </td></tr>
    <tr><td class="paramname">sharedBuffSize</td><td>Size of shared buffer </td></tr>
    <tr><td class="paramname">loggingLevel</td><td>Desired logging level (only messages with lower or equal logging level will be logged, one of the levels at 'logLevels') </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>LOG_STATUS_SUCCESS on success, LOG_STATUS_FAILURE on failure </dd></dl>

</div>
</div>
<a id="a033a9a1b552c4067c8d04a9564093f35"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a033a9a1b552c4067c8d04a9564093f35">&#9670;&nbsp;</a></span>logMessage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int logMessage </td>
          <td>(</td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>loggingLevel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>func</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>line</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Add a message from a worker thread to a private buffer (or write it directly to file if a private buffer is unavailable) NOTE: 'logMessage' should be called only by using the macro 'LOG_MSG' NOTE: this API may be called only after calling 'initLogger(...) API </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">loggingLevel</td><td>Logging level of the message (must be one of the levels at 'logLevels') </td></tr>
    <tr><td class="paramname">file</td><td>File name that originated the call </td></tr>
    <tr><td class="paramname">func</td><td>Method that originated the call </td></tr>
    <tr><td class="paramname">line</td><td>Line that originated the call </td></tr>
    <tr><td class="paramname">msg</td><td>Message data (must be a null-terminated string) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>LOG_STATUS_SUCCESS on success, LOG_STATUS_FAILURE on failure </dd></dl>

</div>
</div>
<a id="a24cb7a769ac91199a40ffd5d0ba0daca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a24cb7a769ac91199a40ffd5d0ba0daca">&#9670;&nbsp;</a></span>registerThread()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int registerThread </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Register a worker thread at the logger and assign a private buffers to it </p><dl class="section return"><dt>Returns</dt><dd>LOG_STATUS_SUCCESS on success, LOG_STATUS_FAILURE on failure </dd></dl>

</div>
</div>
<a id="a8b26c3643213fb562e2a488bc28b3786"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8b26c3643213fb562e2a488bc28b3786">&#9670;&nbsp;</a></span>setLoggingLevel()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void setLoggingLevel </td>
          <td>(</td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>loggingLevel</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Sets logging level to the specified value NOTE: this API may be called only after calling 'initLogger(...) API </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">loggingLevel</td><td>New logging level of the message (must be one of the defined logging levels) </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a4339ec77ab029db1548580313b9dc605"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4339ec77ab029db1548580313b9dc605">&#9670;&nbsp;</a></span>terminateLogger()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void terminateLogger </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Terminate the logger thread and release resources NOTE: this API may be called only after calling 'initLogger(...) API </p>

</div>
</div>
<a id="a73ce845d8dab297b5d82febb0ae35fec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a73ce845d8dab297b5d82febb0ae35fec">&#9670;&nbsp;</a></span>unregisterThread()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void unregisterThread </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Unregister a thread from the logger and free the private buffer for another thread's use NOTE: Each registered thread should unregister before logger termination NOTE: This API may be called only after calling 'initLogger(...) API </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
